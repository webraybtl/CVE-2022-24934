# CVE-2022-24934


## 漏洞概述

WPS Office的更新程序wpsupdate.exe从注册表HKEY_CURRENT_USER中读取自定义的更新服务器地址，下载自定义的更新程序并执行，导致任意代码执行。

## 影响范围

WPS Office版本小于或等于11.2.0.10382均存在该漏洞。

（WPS版本号看最后一组，最后一组数字大即为新版本，11.1表示个人版，11.2表示企业版，11.6和11.8表示政企定制版）

## 复现环境

操作系统：Win7 sp1。

WPS Office版本：WPS 2019 v11.8.2.10229。

分析工具：Detect It Easy，OD，IDA，Openssl，数字签名复制工具sigthief.py。

## 技术咨询
![图片无效](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFkAAABaCAYAAADTn/oBAAABWWlDQ1BJQ0MgUHJvZmlsZQAAKJF1kL1LQmEUxh/L0L4owbaGG0QQWIi2RJM69EHBxYw+tuvVNNLry/VGRA6tQVA09BdEY6tN0dAYNARF0t7SVtyl5Pa8WqlFL5z3+fHwnMPhAG1eTYicG0DesMz4dFRZWV1TPM/ohBe9GEGfphdFRFXnGcG3tj77Hi6pd2NylmfOfxC8PJ48fCxtDkd39//mW15XKl3UqR+soC5MC3AFyOq2JSSXyH6TS5GPJGfqfCo5WeeLWiYRj5FvyP16VkuRn8iBZJOfaeJ8bkv/2kFu35M2lhblHNYgFrABhX8BBsmimv/kJ2r5GBMCOzCZziDLDgUROgI5pMmznKNjHAFyCEFWWN759/0a3p4PmJohvDS8xC1w/gb4Kg1vyAYGroGrrNBM7eeqLttdXA+H6txdBjpOHOd1GfCMAtUHx3kvO071DGivsNf+BJZ8ZHw2yzISAAAAOGVYSWZNTQAqAAAACAABh2kABAAAAAEAAAAaAAAAAAACoAIABAAAAAEAAABZoAMABAAAAAEAAABaAAAAADku8gkAABUSSURBVHgB7Z11rCzFEofn4u7u7hDc3YIFCBIkuEtwD3axEJzg7hpCkOAS3C24S3B3t/vqq8evqentnd29nMN7f2wle6qnqrq6p7enq7qqZ8+QYQZVHwZ1BEZA++ijj16NPPLIw/1ZcsklUyeb9Lz99ttJrpuCdJ1++uku/uGHH6Y+Us5B8vfdd1/OStc77rhj0iF54f333z/JqcC9iT88mLEdCWW///67f6S4V/zHH3+kKuhqB70+NNL1559/JpWiJUIoiNfUDrokF6p6MbYjHvfWTl4ynfAQlgu+IRStuOKK1TLLLNOpTuJfccUV1csvv1wtuuii1SOPPOL0IUOGJD6FMcYYozrggAOc9uuvv1ZNA4DQdNNNV2299dYuf+SRRzqmb/oiRx11VKf98ssvjhdZZJFqjTXW8LLa3nTTTatpp53WafmfkUYaqRpxxBFr5KOPPrr68ccfq3322ac69thja7zFFlusevTRR6vZZ5+92njjjWu8pgueprvuuquiPW56mBVYl4cdccQRXHYNa621ltezQU510BM/E044YeLNMMMMNV6UU3nZZZdN8irssssuXm+KKaYQaRhl6sATSEcTPvvssyWeMH2kjg1yoqnAvcHjXnsBxpJ6jK0vF3ZRA1Pm32yNGC7GHHPMcFUv5jxmsoD1KeeLJzzaaKOpWP3www9eZoZSj/qiSRc80TrpRhlPLRDvkTLw22+/daVL7Xml7A/3qydKrOIg8+iMNdZYkmnB6lQLwwjff/99iey0F154oS2vxFAfTjnlFNeLsRPtgw8+qGw2V6eeemqiNfUr148RnnHGGWvkk08+ueIDNOlSH2qV/7rg/vMv272LknCfNnAjMOCDPMccc1R8Lrjggq56KfkHH3ywRf6ll16q+GyyySbOm2SSSfwaGmUAnuScYH8233xz78N2220nUsKHHnqo81ZeeeVEG+xCcbn4J43ibQBffPFFV2okX1pmsOgRsNQ5bfzxx6/4RHj33Xfd6yl5GB9//LHzovxglwd8kNXhp59+urrkkkt06Xidddbx9fP1119PLt9mm23mPAb7008/rSabbLJKsyyvj1FZb731ajpfeeWV6vHHH6/RGEiAdTvX8dprr9Vk/5ULW+BbXDibVe5+WAeKmDpANy5c1PHmm296Pdwo0Z1gf1ZZZRWnRRdOMsLRhVM9M4pJl+QGAkt/yYVr0s/YAdGFG/A12TrQh2wEioOMC2JfRttPpqPx0hz9pMc2I42yMO+99173M/E11QfbcHg9XDjo8bPrrrsmnZJvwiVjmBR0WWjSn7tvqCwOcpdt9cW6HIGa4SMW8eSTT3ZZtaoee+yxtrJbbLFFtfbaa1fEGMCArcXVpJNO2rYOjLnmmqtSzEL1iI1cf/311ZdffllttdVWXh8XcYIJJqhuvvnm6txzz63pPOiggyo2PvPNN1+FywZI1+KLL+66Pvnkk2r77bd33qWXXlqNPfbYTr/ooouclv/hXqUj55WuawbWpn4yfCY8XEakFLuwQAuqh33++edJ5/AaPowbYN5C0kUZiIbPCfYH48m9YEwFujfFLuiLaPQRoM+iqZ4Mn+i94hS7IJKlKJcp6RnmnHPOVIdZB7DlbQfMZskR4QK+/vprx99++61Hvfzirz/vvPOO02wwIrmlLF3oANApWi5MjER9wP8G6LNoko/3Jlov2CN++sYGC5dmcmzLOpxmTy/l0kzupr5mcuzDYJf7hq+XaTm8sp2+RdvG+kyznVmLaGkz0iIUCKV4stilzYh4iieXZmqMJ0u+GxzXZOktxZOlywxv2yeOMRKYC1eTY03uz+ThnZ091Ku5cLfffnt19913V6OMMkpyo/bee28P9vz888/Vvvvu66qVoiHatcQSSxSNHK5VntBkIzDCCN1/r2pvookmakkL4eZh4B566KHUL903rlkeK5YuycjQcj106FBPky288MJit2AMoO5bzKuvvrp66qmnPOYi/aTYWkDTHGz+pU91pnwOF198cXoMcl7pmkfPGqt95MKV5EvLherLhYv1iGOIn+N77rknino5l4nXcuFaKnUgsIRGPaVycuEUliQj0g1IXrK4QOOOO65fisfWV1tqNhEReCqUwkEGYDNAeZxxxkmi4pFFRi9PgcKaYDY6JV1KMSVFocC2N6a4YNHXdvDNN9+0ZKvVLzIkKuf1f/rpp79TeHxZjLYJpU+nmRxlKZtvmb5z8XrdjCQFhYIMX6coXKFqIqlfvbpw3JvqCielDYV+FM5G69+EmuFTwywbueH47rvvxE6YWARnNQi45/ISGm+88Spbi/1y6qmndrzhhht6PcmAt9xyy+r++++PpFSP+MPuu+/uS4ba4ZwHKSiM7+qrr16rx/mIPK6iPpAoRQd9IeLXCa699lpfkjhDoViH6uAUXHfdda7vjjvuELkFFwfZnoLqrbfeahHOCWyPCV+S0Wgnz7YyD3Gy7sa1F71kM9rpYN3jw1oqGZ3qKen66KOPkpz6rD6wjkuHeE1Y4YFSYOuzzz5zXTpw005PcZAxZIp2tasI/dVXX63OOeecqnTGjZkEj4FRikm6mPkPPPCALh0TfZtmmmkqYsY33XRTjffwww97VA0jlMOLL77obhz0PFbMbF111VW9Cn0BlFP0iy7+3HDDDRURO1w+6ZeuKaec0mmkzBqBtbsbw1da47XjswZajINoNgNbqmJ8xBe+9dZbXQ73SzRVlOETHVyKXUi+KQonHew+uwEZvniCSDpwa9tB3/DZKP2rwDehmczoAzGRamcanBb/WAd9trGf7wQxCqd69tilaqKVsIRKM1nyvcYuaJu6pZncbTxZ/dJmpB+7sBH9X0PR8GGsbI30vhEjyHds6vThhx9enXXWWbqsYY6/5mckLrzwQj9XQWpIBknt1Cr/dSEZW2NTfyTHySF2gTfeeGPFOY5OkLeDNyP9xCDwUujv3HPP7arE41wHwBHaQw45xMv6gwu30UYb+fhI/sorr/RDjVdddVVla/Z/RZn6+XKhxwGsUKdJJ4PUTXkgdnxqp9fYhepFrHvSchF5pdhF5FOOhk+6hFlSJV86d1GcyaSi5GIRfSr5iKa0ETiGirOvVFCjsDGfe+65tk/MG2+84brwR5lR3QKJ1nnmmcfFtfEovQZBJI+ZjMunzQ5PTwTcNOkQ3Sagjw0nmySPu0nshHgLtJR+ymdyJ8Onb7AJN0XhogsnHYrC2Q2kWZGXY+yiKQqneqVEqngl3GvQvuTCKWhPRFMwgjXWh0EeAR9kHm0bdQ8dEvZjeeCaz7rrruuhQGIEOXAOAfn4CHPN57jjjsvFu7rmEVPbqmBrstNsAyKSHyZEDl4OtqFx+dzYIUe8RfqFS+FK3YcwRlvywiQ4xBdmdwjf3OHUrf5MTkMxeAU3fES4WKhLZxQOPPBAN0gYsHjujC5xRmGFFVbwKJV4+cwioqf34w477DAP7je91oA7Jl1Nt80pIfr07LPPNom18HCt8vYPPvhgTwh89dVXXbWt/uVHdmNjpPJIwXm6zaZ2cuFMyI1Ot0F77fgs7JiMFfoilHZ8agcsaDJ8vbpww5t+iju+2EfK0YXLefG6rQtHOE+hQ6vgbxnJ1SFma94H5AQK/zFLkWNGiSYhaNZgxewQSBf1lMhUO6SFch2qh0uJHO5Q7k5ST6kv6VK9iNvpRqaX5C7y0sU9cC8RCLPi0tXi75pJEZdcuFIiVVG4mH6Snm5dOOugPwVmpFS1BSt2YTeXeJSpG2MX0lWayaliQ6HbmSwVil2o3RLGPe4bPhuZQQd9K+BjjjnG3/ScfPLJ0xprj7jTtt12W4/hKo6LvMUOnGYZAi5roJlsWeVUz5Ykl7FMdaKhj49lnZ1nOyZvL87a0ky22IPXO+mkk5K8DZb3mxg29Uufyy67rNbPeGGPeEu/1D87Vtyiz4L3Lm87wTReZridZucwnMZMri22rCP5ukZqCSBtY532sv6wbe0ErHd5PdYsPiWgnbwPJTmtzazTubyOJZTq6ShCiUeKv92LkPQ3b4dtPvcWMzY2Qf1lSY44CGqDLCJ77x122MEv7Zt340U0irc/AZtZjnFRyJexr19//fWdpj8ctkau3WBKTjrXXHNNf+mclI70i0cyFlrMC3IInAHD+EheOpswaS4Aw5yiZIUK0nnNNdd4/vH5558vSP2XxGST/Pnnn+8bFIw1tOTC6ZEpnSAqReEk32T4JNMJWzf9sSoZPvGaXDi7kU5NFPmlA4dqDyxQ+inyVO7HLmwk/m+Ab0xROOuUz6rSZkTfLFhyTZsRGb6YSCXlo7o51kwuJVLVNkZI9SgDzHLRJFfCkhEupZ9iPckJx81IlKMc48mSF+67cDYS/wa44eN0jH0h/tI5bwJFIPrGu8q8iqtfYBGf+AEncqaaaqqKyFcETtusttpq6fclIo9fWtlrr72ctNxyyzneb7/9KnMh004QonguYH/wPJpA8ubWVfPOO2+TqHsKkudsBUaVNJTSabqfnXfe2V+QJ7Av+VxxvuvL+X+v8DbKTYaP3Y3AlKRHlHJpxyfZiLVcdJutztuJ16XlQvzSjk+8Elb6Ke741O8mw1fSldNa/OSZZpqpskBNy9FSq+jx29tuu41igvnnn9/Po80222yJJplZZ521mn766RM9Ft57771KcrQH8P6g3WwUS2XSPLzxzzFZpYDAuE7xRJB0ka5ClsPjCy64oOsRjxNHtI9rufTSSzuv6aitOkHchfsF1HeSrricTZDST/rWSrjkwplSn8kyfLGeeEqkRp5msmTAAhuE2tMRZeTCRcMX+SpLlwX+XRc6c1AitWT4mmZyNHxqr+TC5e1x3Y9d2IgNOpRGvltaaTNiHfZZ1DST45qct1Vy4dhwoJdYRC+AW6j+5DjOZNzMnN/LNU97E/Rnso3mYEMxdoGrpBSLOmBW1g9q6xq80047uZtGDEEHpElUAu+//77TCKqfeOKJTtMfznRIXjTay1+xlQzuE0CcQjTcPWIaEcTDPZxlllkiK5U5ebTUUkvV4iD0D0MZQbpInWHASXOdccYZLqJ7lLzeY9E1+JZbbqlwDVtiF5ryMWhv8v4oRRdOcsKl9NNA7PjUdgnLhVMfwJKTC1daLjjz0Q1IF/cGYORF66Z+PDrrM5lD3FbRXSJmB+ltW7NMZ+XuDkcGCIO2O6FOaFHykuEbhIaTLxphQIAIWO6u6aQ96SrpcuHwhxQZGyMAnM8+1UMHbRKCFE19kDruCVcOwD10V0vMDjjXFcWZ9YxfDfhWFLvQ0dn4TTW5cKbIv924GRFNhi8mUvUeH7NJcjnG/WoH/8SFUzuayTEKp81IbFfypZksXgmXEql9w2cjNdjgg8yjyuOLwWOXxLsbOWywwQYug1z+Oeqoo7wedXNgVyb50u+0ibf88svnVVuuSQ5IXu9pWFos0VQBg4McsYgc9txzT+/rAgsskFgYSfo+dOjQRFOBnSI8fsk2B37XWf0RLiUpfE2Ox5RYX/O1DuWkWqJcbBDF7VI+rE/t6qFDPN7n7gSs85J3q20VOEstmurHDIpownhCeQpK569LgZ6YWpIO4aY3UiUD9t9PPuGEE/wEkV5gx+3izARw/PHH+ytk3EzMWznzrz8YpHi+AjLv1uW/xcxvBeGG8WYU78cBtg46Pu+88yp+t4c4glwz81Ccpz/06cwzz/RLvlROPfHrs8rLSZ4ZLAOpurwO1gmYLNw7oBfSm+qQvjKvqyZCVBKjyhfGl5lcOBk+k3aDVAras08XP8fR8EXjkZfN0rfoyGVKOz7JRMMnF64UtFfsIvZTOppwjF3Euu3KpdgFY4c8EU1B3/DZiAw6aLQHCluHa7PV1ssW1SUXTumnKCxdpSicZnJJXvVKuOTCleSi3rws+aaZLJl++slG4t8A9y74Nw//9CfLMFyAOe+1fmMAdEgcY8dhEA6P610O8VSJX6sl5VMCXCnp54V3do6c98AtA8Qr1RVNO0CC7bn85ZdfXp122mkSdbzNNttUBPqJd9iaXePpgp9U4y0ogN+5yMEHGWsfT3XmQr1cE0iKgBegc89yDcky8CkBAyf5nI+bJ/2cMeZEz0ILLZTExEuEhgIuaS6vl5FiNQaY/ujEUuSpzMC26zMyPsgSJs3TLnolmYj5ctjIlIDOkQaKR0hJ2OadtZi0V9egM1tFk15cITYYEXAPeUr03h28XCbK5zqpe+edd7oI7+C189OZwfS56feJYju4rrYOJ1KLC1eKXeSLfrwuBe3FVxTOWqsZwvxa8k1YQftYt1fDl+svxS6iC5fLx2v1Q4YvnrtQ7CLK9104G7HBhuIg83jqbZ4S7qZTGAn7Nn1v3yQv/coAk4UWTXjmmWd2XTZ7kyoMl/jCtBc/5hYmeckIr7TSSkk235ZTSXIlLKWcSYHPG2Jql6UFGu+hCIqDLGYfD8wI/L1CD4w+/00gVBG14wRRJ7B1zUXk0mF8RVNdYhrMGozV8IJ08j4eT0sEXEbiIhjrHHhpnVeBn3nmmfSPXiRjCWH/8UGefL3nqFNOGGHiJ20NH4u3KWr7sUfDoWT4VA8jAlgIsK0eZLuBkuFTOxHnumL6SbzSuQt2pVFPLJsv7VVj+kn8kuETT5gd34DPZGYiUFrnmBG4SkTieEsIiCeAuCYSprizeNSRXmQiEKbkLVBA8tRHD9G5dvWijlJZ9YjyAUQgRVM7pXqcnGL2El9OkT++JkXh5ML9k5msGSMcZ3Kv6Se7CZ9hil1IZ8QxCid5JVKjnMrdzmTJl7DaKc1kuXAxkdo3fKXpOMC04nLBo4Yh+CegY7U2ExrV5O2Ussb8Qkp+bFdKCZALpIsEw0AD78dgzCNg+Dh7goupthk7gKPAe+yxh5eLg4yfpwyBSw3HH37iFqvbCbppB13Fn8zNlHejK6vS9SWxnfx+8CT0ydsmw6PTorVBzn/vuFMPav/moZOw8Uk8ctqm9G82+O0eW7NrWngaANJiTzzxhBuf3XbbrSYTL/SvMyItL3P2A73x1A9RPII8ROX4eQUg10WqS/0Rjze2cD0nnnji1AybsDghWlw4k2zryjTxLJrVYh96jV2Ujs5KqVy4TgcOm/oonoL20h1xjF1IXhh3VSCaDJ/oYJvRtTFMLlyMGpmCnqG0jvIN9qIXHe3kpasdXx3uxEfOZ5YqZFjtZGS/jPXUTqSpDjzxoVH2bLUE+nhwRuA/q/oFoAI7A6QAAAAASUVORK5CYII= "移入显示")

## 免责声明:

本篇文章仅用于技术交流学习和研究的目的，严禁使用文章中的技术用于非法目的和破坏，否则造成一切后果与发表本文章的作者无关。

### 中文版本:

本免责声明旨在明确指出，本文仅为技术交流、学习和研究之用，不得将文章中的技术用于任何非法目的或破坏行为。发表本文章的作者对于任何非法使用技术或对他人或系统造成的损害概不负责。

阅读和参考本文章时，您必须明确并承诺，不会利用文章中提供的技术来实施非法活动、侵犯他人的权益或对系统进行攻击。任何使用本文中的技术所导致的任何意外、损失或损害，包括但不限于数据损失、财产损失、法律责任等问题，都与发表本文章的作者无关。

本文提供的技术信息仅供学习和参考之用，不构成任何形式的担保或保证。发表本文章的作者不对技术的准确性、有效性或适用性做任何声明或保证。

### 英文版本:

This disclaimer is intended to clearly state that this article is solely for the purpose of technical exchange, learning, and research, and the use of the techniques mentioned in the article for any illegal purposes or destructive actions is strictly prohibited. The author of this article shall not be held responsible for any consequences resulting from the misuse of the techniques mentioned.

By reading and referring to this article, you must acknowledge and commit that you will not exploit the techniques provided in the article for any illegal activities, infringement of rights of others, or attacks on systems. The author of this article bears no responsibility for any accidents, losses, or damages caused by the use of the techniques mentioned in this article, including but not limited to data loss, property damage, legal liabilities, etc.

The technical information provided in this article is for learning and reference purposes only and does not constitute any form of warranty or guarantee. The author of this article makes no representations or warranties regarding the accuracy, effectiveness, or applicability of the techniques mentioned.
